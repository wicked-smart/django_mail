setup:
  addons:
    - plan: heroku-postgresql
      as: database
    - plan: heroku-redis
      as: broker  
  
  build:
    docker:
      web: Dockerfile
    
  env:
    DJANGO_SECRET_KEY: $DJANGO_SECRET_KEY
    DATABASE_URL: $DATABASE_URL
  
  release:
    image: web
    command:
      - python3 manage.py makemigrations 
      - python3 manage.py migrate
      - python3 manage.py collectstatic --no-input

  run:
    web: gunicorn mail.wsgi
    worker: celery -A mail worker --loglevel=info